## V1_0807_0809

基本保持省赛代码，把激光测距部分独立为lidar_processing模块文件，电机控制部分删去没有实际使用的位置pid，把直径参数改为新橡胶轮子的直径

## V4_0810

### prompt:

这是一个控制轮子分控stm32的完整可运行的项目代码，现在存在一些问题：
* 轮子加速减速过于剧烈
* 轮子在目标位置附近有可能一直“到不了位”而卡住，不进行反馈“1\r\n”，使得主控无法继续任务
* 现在的代码有些冗余和不清晰

希望你重构电机控制的相关代码，要求如下：

* 进行重写
* 只能修改电机控制相关内容，也就是motor.c,motor.h,main.c,可能可以修改pid.c,pid.h，但一定不能修改激光测距相关内容，也就是lidar_processing和stp_23l
* 硬件交互的部分，也就是控制定时器，以达到控制pwm波输出的部分，这些也已经定死了，已经在cubemx中配置好了，希望你不要进行改动
* 再重复阐述上一点：因为现今的代码是能够正常运行轮子的，所以直接控制硬件的部分是正确的，请你不要修改这部分太多导致轮子不能正常运行了
* 最好保持主控向分控发消息的格式不变
* 让轮子运动更平滑，同时又保持高速，以下是一个我的可能的方案：
   1. 根据传入的目标距离与当前距离，规划分段控制速度的方案
   2. 在刚开始和将近结束的段，进行匀加速；在中间段，进行匀速
   3. 以上所说的大部分的段落应该只需要速度进行PID即可
   4. 分段的距离和中间段的速度应当是作为参数可调的
   5. 在运动结束位置附近可以引入位置PID，或者是缓慢地到目标位置，或者任何你觉得可行好用的方式，防止出现在结束位置附近到不了位置的情况出现
* 向主控传回反馈信息的部分，加入可选的超时机制，再次防止太久到不了目标位置而卡住
* 代码不要太过冗余，不需要特别特别强的鲁棒性或者说太多太多的功能，只需要满足电机控制的基础功能以及以上我说的功能即可

- 重构是可以比较大胆的,程序架构、变量名什么的可以看起来很不一样(为了让程序、变量等更加清晰)。只是直接控制电机的pwm波这样直接控制电机的代码最好不要改动太大，另外当前的速度PID是已经调参过的很好用，也不要更改。
- 电机的”停止“,希望有两种:一种是电机维持当前位置不变(就是如果有外力作用,能阻碍移动,并能快速回到原来的位置)(而且默认的”停止“应当都使用这种停止),一种是完全不给电机输出电压了,让他自由转动(这种实际上现在还用不到,只是备着),请你写成两个函数加以区分
- 对了,请你想办法计算以下当前能用的最大转速,然后把默认参数的中间段的转速改成最大转速
- 另外,我希望所有可能需要调整的参数都是能够集中在一个或几个地方方便可调
- 我想新增一个环：保持两侧的距离一致，因为我们的两个轮子放在两侧的轨道上，如果两侧距离差过大，车会走不动卡住，请你找合适的位置添加
- 很重要的一点：不要画蛇添足，不要让代码太过庞大和繁杂，参数不要太多太多，实现基本功能以及我说的功能，以及你觉得有必要的功能即可，不需要调试、测试等的代码

## V6 0810

用AI重写的代码，加入了：超时、梯形速度规划

实际效果不好，一方面是启动时就会把铝管带偏很严重，另一方面是结束时会前后颤动

## V1_0807_0811

加入超时机制，发现还是原来的代码好用，并且增强了接收数据的鲁棒性

## V7_0811

在V1_0807_0811版本上修改

仅仅将“电机停止”全部改成了主动刹车（主动保持车轮转速为0）

## V15_0818

超时参数已测出，但超时机制无法使用，进超时后电机疯转，超时机制废弃